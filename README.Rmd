---
title: "How to make tables from lineare models in R"
author: "Edson Silva-Júnior"
date: "`r Sys.Date()`"
output: html_document
---

# How to make tables from lineare models in R

Linear models are one od best tools to statísticla analysis to linear variables, able us to understand patterns and tendences about our data. Despite its aplicabilities, it's often researches having dificultes to automatizate tables with them linear models results.

In R, with simple annd few steps, we can builds and  export tables with our statístics values.

# Required packages

To build our table, we use the required packages:

-[ecodados](https://github.com/paternogbc/ecodados): to load our data to construct our model;

-[tidyverse](https://tidyverse.tidyverse.org/): to transform and manipulate our data;

-[performance](https://easystats.github.io/performance/): to check [linear model assumptions](https://www.jmp.com/en/statistics-knowledge-portal/what-is-regression/simple-linear-regression-assumptions);

-[flextable](https://ardata-fr.github.io/flextable-book/): to construct our statistics and exportable table.

```{r}
library(ecodados)

library(tidyverse)

library(performance)

library(flextable)
```

# Data

## Importing 

Our data are a dataset about amphibians, contening information about:

-`Município`: information about municipality where its amphibian was sampled;

-`CRC`: information about amphibian [Snout-Vent Length](https://en.wikipedia.org/wiki/Snout–vent_length) ("CRC", in portuguese) in millimeters, the length between its snout to its vent, a large-used measure in [herpetology](https://en.wikipedia.org/wiki/Herpetology);

-`Temperature`: municipality anual mean temperature where amphibian was sampled, in C°;

-`Precipitação`: municipality anual mean precipitation where amphibian was sampled, in millimeters.

Those data were originaly from [Boaratti & Silva (2025)](https://onlinelibrary.wiley.com/doi/full/10.1111/aec.12267?casa_token=o9CICQ4-dEUAAAAA%3AWlTT9C8ujxahR7xR7RNcQbHeCVxAATTFwtD6esgl0IWReB0164RHNXNM-YjqLDtbIpY55ydgNWxvgHc).

```{r}
data <- ecodados::regressoes
```

## Visualizing 

To check if `CRC` to `Precipitação` variables are numeric variables, we use `glimpse()` function, from `dplyr`, a `tidyverse package`.

```{r}
data

data |> dplyr::glimpse()
```

# Modeling

To our analysis, we want to test if temperature and precipitation affect amphibian CRC. 

## Creating a linear model 

To perform our model, we use `lm()` function, indicating CRC as response variable and else variables (`.`) as predictor variables, filtering only variables from dataset (`[, 2:4]`).

```{r}
linear_model <- lm(CRC ~.,
                   data = data[, 2:4]) 
```

## Check assuptions 

Linear models have some assumptions, to minimize [Type-1 error chances](https://en.wikipedia.org/wiki/Type_I_and_type_II_errors):

-Independence for samples units: sample units may be independent information, not to be influenced by else sample units;

-Avoiding multidisciplinary: in case for multiple linear models, predictor variables may not to be correlated, checking through correlation indexes or VIF values;

-Errors may be normal distributed (Gaussian distribution): errors (residuals, the differences between data values and predicted values) should form or to next to a Gaussian distribution;

-Errors may be homocedasticity variade: the relationship between errors and predicted values may to form or to next to homogenize variation.

To check those assumptions, we use `performance` package:

-`multicollinearity()`: check whether there is model multicolinearity, through VIF values. Traditionally, researches adopted `VIF = 5` as threshold to detect critic multicolinearity;

-`check_normality()`: use Shappiro-Wilki hypothesis-test to test whether residuals are next-gaussian distributed;

-`check_heteroscedasticity()`: use Breuch-Peagan hypothesis-test to test whether residuals are next-homogenean varianced;

-`check_model()`: to visualize all previously assumptions from graphs.

```{r}
linear_model |> performance::multicollinearity()

linear_model |> performance::check_normality()

linear_model |> performance::check_heteroscedasticity()

linear_model |> performance::check_model(check = c("vif",
                                                   "homogeneity",
                                                   "qq",
                                                   "normality"))
```

now we check all assumptions were accepted, we can continue to construct our table.

## Model statistics 

```{r}
linear_model |> 
  summary()
```

# Statistics table 

## Making a dataframe with summary statístics

```{r}
summary_table <- linear_model |> 
  summary()

summary_table <- summary_table$coefficients |> 
  as.data.frame() |> 
  tibble::rownames_to_column()

summary_table
```

## Editing the table 

```{r}
summary_table_trat <- summary_table |>
  dplyr::mutate(Estimate = Estimate |> round(4),
                `Std. Error` = `Std. Error` |> round(4),
                `t value` = `t value` |> round(2),
                `Pr(>|t|)` = dplyr::case_when(`Pr(>|t|)` < 0.01 ~ "< 0.01",
                                              .default = `Pr(>|t|)` |> 
                                                round(3) |> 
                                                as.character()),
                rowname = rowname |> stringr::str_remove_all("\\(|\\)")) |> 
  tidyr::unite(2:3,
               col = "β1 ± SE",
               sep = " ± ") |> 
  dplyr::rename("Predictor" = rowname,
                "t" = `t value`,
                "p" = `Pr(>|t|)`)

summary_table_trat
```

# Turning into a flextable

```{r}
summary_flex <- summary_table_trat |> 
  flextable::flextable() |> 
  flextable::align(align = "center", part = "all") |> 
  flextable::width(width = 1.5) |> 
  flextable::width(width = 0.75, j = 3:4) |> 
  flextable::bg(bg = "white", part = "all") |> 
  flextable::bg(i = ~p < 0.05,
                bg = "gray70")

summary_flex
```

## Exporting

```{r}
summary_flex |> 
  flextable::save_as_docx(path = "linear_modelo_table.docx")
```

